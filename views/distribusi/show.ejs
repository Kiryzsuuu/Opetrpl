<%- include('../partials/page-start', { title }) %>

<div class="d-flex justify-content-between align-items-center mb-4 page-animate">
  <div>
    <h2 class="mb-1"><i class="bi bi-truck"></i> Detail Distribusi</h2>
    <div class="text-secondary small">Tujuan: <strong><%= distribusi.tujuan?.nama || '-' %></strong></div>
  </div>
  <div class="d-flex gap-2">
    <a href="/distribusi/<%= distribusi._id %>/edit" class="btn btn-primary"><i class="bi bi-pencil"></i> Edit</a>
    <a href="/distribusi" class="btn btn-outline-secondary"><i class="bi bi-arrow-left"></i> Kembali</a>
  </div>
</div>

<%- include('../partials/flash') %>

<div class="row g-3">
  <div class="col-lg-8">
    <div class="card">
      <div class="card-body">
        <dl class="row mb-0">
          <dt class="col-sm-4">Kode Distribusi</dt>
          <dd class="col-sm-8"><%= distribusi.kodeDistribusi || '-' %></dd>

          <dt class="col-sm-4">Produksi</dt>
          <dd class="col-sm-8">
            <% if (distribusi.produksi) { %>
              <span class="badge bg-secondary"><%= distribusi.produksi.kodeProduksi || '-' %></span>
              <span class="ms-2">Batch <%= distribusi.produksi.batchNumber || '-' %></span>
              <% if (distribusi.produksi.formulasi) { %>
                <div class="text-secondary small mt-1">Formulasi: <%= distribusi.produksi.formulasi.nama || '-' %> (<%= distribusi.produksi.formulasi.kode || '-' %>)</div>
              <% } %>
            <% } else { %>
              -
            <% } %>
          </dd>

          <dt class="col-sm-4">Tanggal Distribusi</dt>
          <dd class="col-sm-8"><%= distribusi.tanggalDistribusi ? new Date(distribusi.tanggalDistribusi).toLocaleDateString('id-ID') : '-' %></dd>

          <dt class="col-sm-4">Jumlah Produk</dt>
          <dd class="col-sm-8"><%= distribusi.jumlahProduk ?? '-' %> <%= distribusi.satuan || '' %></dd>

          <dt class="col-sm-4">Tujuan</dt>
          <dd class="col-sm-8">
            <div><strong><%= distribusi.tujuan?.nama || '-' %></strong></div>
            <div class="text-secondary small"><%= distribusi.tujuan?.alamat || '' %></div>
            <div class="text-secondary small"><%= [distribusi.tujuan?.kota, distribusi.tujuan?.provinsi, distribusi.tujuan?.kodePos].filter(Boolean).join(', ') %></div>
            <% if (distribusi.tujuan?.kontak) { %><div class="text-secondary small">Kontak: <%= distribusi.tujuan.kontak %></div><% } %>
          </dd>

          <dt class="col-sm-4">Penerima</dt>
          <dd class="col-sm-8">
            <div><%= distribusi.penerima?.nama || '-' %></div>
            <div class="text-secondary small"><%= [distribusi.penerima?.jabatan, distribusi.penerima?.kontak].filter(Boolean).join(' • ') %></div>
          </dd>

          <dt class="col-sm-4">Kurir</dt>
          <dd class="col-sm-8">
            <div><%= distribusi.kurir?.nama || '-' %></div>
            <div class="text-secondary small"><%= [distribusi.kurir?.noKendaraan, distribusi.kurir?.kontak].filter(Boolean).join(' • ') %></div>
          </dd>

          <dt class="col-sm-4">Estimasi Sampai</dt>
          <dd class="col-sm-8"><%= distribusi.estimasiSampai ? new Date(distribusi.estimasiSampai).toLocaleDateString('id-ID') : '-' %></dd>

          <dt class="col-sm-4">Tanggal Sampai</dt>
          <dd class="col-sm-8"><%= distribusi.tanggalSampai ? new Date(distribusi.tanggalSampai).toLocaleDateString('id-ID') : '-' %></dd>

          <dt class="col-sm-4">Status</dt>
          <dd class="col-sm-8"><span class="badge bg-info"><%= distribusi.status || '-' %></span></dd>

          <dt class="col-sm-4">Catatan</dt>
          <dd class="col-sm-8"><%= distribusi.catatan || '-' %></dd>
        </dl>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <div class="card">
      <div class="card-body">
        <h5 class="mb-3">Aksi</h5>
        <form action="/distribusi/<%= distribusi._id %>?_method=DELETE" method="POST" data-confirm="Hapus data distribusi ini?" data-confirm-btn-class="btn-danger" data-confirm-ok-text="Hapus">
          <button class="btn btn-danger w-100" type="submit"><i class="bi bi-trash"></i> Hapus</button>
        </form>
      </div>
    </div>
  </div>
</div>

<%- include('../partials/page-end') %>
